<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Environmental Source Apportionment Toolkit (ESAT) &mdash; Environmental Source Apportionment Toolkit (ESAT) 05/09/2024 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=b5dd6643"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Python API" href="docs/modules.html" />
    <link rel="prev" title="Welcome to EPA ESAT’s Documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Environmental Source Apportionment Toolkit (ESAT)
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Welcome to EPA ESAT’s Documentation!</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Environmental Source Apportionment Toolkit (ESAT)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pmf5">PMF5</a></li>
<li class="toctree-l3"><a class="reference internal" href="#esat">ESAT</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notebooks">Notebooks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rust-requirements">Rust Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-docs">Creating Docs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-wheels-and-compiling-rust">Building Wheels and Compiling Rust</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docs/modules.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/cli.html">Command Line Interface</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Environmental Source Apportionment Toolkit (ESAT)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Environmental Source Apportionment Toolkit (ESAT)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="environmental-source-apportionment-toolkit-esat">
<h1>Environmental Source Apportionment Toolkit (ESAT)<a class="headerlink" href="#environmental-source-apportionment-toolkit-esat" title="Link to this heading"></a></h1>
<p>Last Update: 02-26-2024</p>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading"></a></h2>
<section id="pmf5">
<h3>PMF5<a class="headerlink" href="#pmf5" title="Link to this heading"></a></h3>
<p>The EPA’s Positive Matrix Factorization (PMF) Model is a mathematical tool that processes a dataset of feature concentrations across many samples (and concentration uncertainties) to estimate a set of sources and their contributions. PMF5 can be used on a wide range of environmental data and is a powerful tool for estimating source apportionment: https://www.epa.gov/air-research/positive-matrix-factorization-model-environmental-data-analyses</p>
<p>PMF version 5 was released in 2014 and is no longer being supported. PMF5 still has an active, international user community; making the development of a modern replacement a worthwhile effort. The primary goals for a PMF5 replacement would be to develop and release an open-source tool that replicates the functionality of PMF5 while also providing new data analytics features and techniques.</p>
</section>
<section id="esat">
<h3>ESAT<a class="headerlink" href="#esat" title="Link to this heading"></a></h3>
<p>The EPA’s Environmental Source Apportionment Toolkit (ESAT) project provides an open-source python package with which
source apportionment workflows can be programmatically created and run. The features available in the ESAT package
include data preprocessing and cleaning, non-negative matrix factorization (NMF) algorithms (currently two options are
available), solution analytics and visualizations, error estimation methods, and customized constrained factorization models.
These features reproduce and expand upon what is found in EPA’s PMF5 application, which is no longer being updated
or maintained.</p>
<p>ESAT python package focuses on source apportionment estimates using NMF algorithms. These
algorithms are implemented both in python using numpy functions as well as in Rust for an optimization option. The
two currently available are:</p>
<ol class="arabic simple">
<li><p>LS-NMF: Least-squares NMF, a well documented and widely uses NMF algorithm. The ls-nmf algorithm is available in the NMF R package.</p></li>
<li><p>WS-NMF: Weight-Semi NMF, a variant of the NMF algorithm which allows for negative values in both the input data matrix and in the factor contribution matrix.</p></li>
</ol>
<p>Source apportionment solution error estimation methods are also available, which are the same methods that are found in PMF5.
These are:</p>
<ol class="arabic simple">
<li><p>Bootstrap (BS): the input dataset is divided into multiple blocks and randomly reassembled to attempt to quantify the variability in the factor profiles and contributions.</p></li>
<li><p>Displacement (DISP): the solution factor profiles are all individually shifted (both increased and decreased) to determine the amount of change required for the loss value to reach specific dQ (change in Q) values.</p></li>
<li><p>Bootstrap-Displacement (BS-DISP): the combination of the two error estimation methods. Where for each Bootstrap dataset/model, all or targeted factor profile values are adjusted using the DISP method.</p></li>
</ol>
<p>Lastly, constrained models are able to be created where the user can define constraints and expressions which set or limit specific factor elements (single values from either the factor profile or factor contribution matrices), or define correlations between factor elements as linear expressions.</p>
</section>
<section id="notebooks">
<h3>Notebooks<a class="headerlink" href="#notebooks" title="Link to this heading"></a></h3>
<p>Code examples are available in the repository jupyter notebooks, which also provided detailed algorithm documentation and complete workflow examples.</p>
</section>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Link to this heading"></a></h2>
<p>Code has been developed and tested using Python 3.12</p>
<p>Code runtime requirements can be found and installed using the requirements.txt file.</p>
<p>Development environments requirements, for running jupyter notebooks, compiling Rust code, and running Sphinx for documentation can be in the requirements-dev.txt file.</p>
<section id="rust-requirements">
<h3>Rust Requirements<a class="headerlink" href="#rust-requirements" title="Link to this heading"></a></h3>
<p>The python package includes a Rust module for running the algorithm update procedures, which requires local compiling to execute.</p>
<p>To run the Rust functions that is specified by the optimized parameter, requires that Rust is installed (https://www.rust-lang.org/tools/install) and the python package maturin (https://pypi.org/project/maturin/) is installed to the python development environment.
Then from the python env and the project root, executing <i>maturin develop</i> will compile the Rust code and place it in your python environment path. To compile optimized Rust code, include the <i>-r</i> or <i>–release</i> tags.</p>
<p>The Rust code can also be compiled to the target directory inside of project root using <i>maturin build</i>.</p>
<p>The rust functions are imported as python functions, with the ‘from esat_rust import esat_rust’</p>
</section>
<section id="creating-docs">
<h3>Creating Docs<a class="headerlink" href="#creating-docs" title="Link to this heading"></a></h3>
<p>The documentation is created using sphinx and several extensions.</p>
<p>If creating or adding new rst files run <i>sphinx-apidoc -o docs esat</i>.</p>
<p>To create, update or modify the existing documentation html, run
<i>sphinx-build -M html . docs</i> from the command line at the project root directory running the python environment with the necessary sphinx packages.</p>
</section>
<section id="building-wheels-and-compiling-rust">
<h3>Building Wheels and Compiling Rust<a class="headerlink" href="#building-wheels-and-compiling-rust" title="Link to this heading"></a></h3>
<p>The ESAT python package and cli are built using setuptools and setuptools-rust, with configuration details defined in pyproject.toml and Cargo.toml.</p>
<p>The python package can be built with the standard <i>python -m build</i> from the project root directory.</p>
<p>Build will compile the rust code and package up the python
code combining them into the wheel for distribution. The resulting wheel and compressed file will be found in the project dist directory.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to EPA ESAT’s Documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="docs/modules.html" class="btn btn-neutral float-right" title="Python API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, EPA.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>